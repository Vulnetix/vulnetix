generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Session {
    kid        String  @id
    orgId      String
    org        Org     @relation(fields: [orgId], references: [uuid])
    memberUuid String
    member     Member  @relation(fields: [memberUuid], references: [uuid])
    expiry     Int
    issued     Int
    secret     String?
    authn_ip   String?
    authn_ua   String?

    @@index([orgId, memberUuid])
}

model Org {
    uuid                  String                @id @default(uuid())
    name                  String                @unique
    createdAt             Int
    enforceGitHubOAuth    Int                   @default(0)
    enforceCompanyDomain  String?               @default("")
    members               Member[]
    sessions              Session[]
    git_repos             GitRepo[]
    integrations          IntegrationConfig[]
    integration_usage_log IntegrationUsageLog[]
    findings              Finding[]
    sarif                 SARIFInfo[]
    cdx                   CycloneDXInfo[]
    spdx                  SPDXInfo[]
    branches              GitBranch[]
    tags                  Tags[]
    gitHubPAT             GitHubPAT[]
    gitHubApps            GitHubApp[]
    gitHubOAuth           GitHubOAuth[]
    reports               Report[]
    requirementResults    RequirementResult[]
    triagePolicies        OrgTriagePolicy[]
    queueMessages         QueueMessage[]
    collections           Collection[]
    collectionRepos       CollectionRepo[]
    teaProducts           TeaProduct[]
    teaComponents         TeaComponent[]
    teaReleases           TeaRelease[]
    teaCollections        TeaCollection[]
}

model TriagePolicy {
    uuid                                  String  @id @default(uuid())
    name                                  String
    description                           String?
    createdAt                             Int
    enabled                               Int     @default(1)
    isSystem                              Int     @default(0) // 1 = system/global, 0 = org-specific
    cvssCriticalRemediationDays           Int
    cvssHighRemediationDays               Int
    cvssMediumRemediationDays             Int
    cvssLowRemediationDays                Int
    remediationCriticalThresholdAllowance Int
    remediationHighThresholdAllowance     Int
    remediationMediumThresholdAllowance   Int
    remediationLowThresholdAllowance      Int
    triageThresholdDays                   Int
    exposureWindowDays                    Int
    severityHighThreshold                 Float // 8.9 for CVSS
    severityMediumThreshold               Float // 6.9 for CVSS
    severityLowThreshold                  Float // 3.9 for CVSS

    orgs        OrgTriagePolicy[]
    collections Collection[]      @relation("CollectionTriagePolicy")
}

model OrgTriagePolicy {
    orgId          String
    triagePolicyId String
    org            Org          @relation(fields: [orgId], references: [uuid])
    triagePolicy   TriagePolicy @relation(fields: [triagePolicyId], references: [uuid])

    @@id([orgId, triagePolicyId])
}

model IntegrationConfig {
    uuid       String  @id @default(uuid())
    orgId      String
    org        Org     @relation(fields: [orgId], references: [uuid])
    name       String
    label      String?
    created    Int
    suspend    Int?    @default(0)
    configJSON String?
}

model Group {
    uuid    String         @id @default(uuid())
    name    String         @unique
    members MemberGroups[]
}

model MemberGroups {
    groupUuid  String
    group      Group  @relation(fields: [groupUuid], references: [uuid])
    memberUuid String
    member     Member @relation(fields: [memberUuid], references: [uuid])

    @@id([groupUuid, memberUuid])
}

model Member {
    uuid                  String                @id @default(uuid())
    createdAt             Int
    email                 String                @unique
    orgId                 String
    org                   Org                   @relation(fields: [orgId], references: [uuid])
    groups                MemberGroups[]
    passwordHash          String
    avatarUrl             String?
    firstName             String?
    lastName              String?
    alertNews             Int                   @default(0)
    alertOverdue          Int                   @default(0)
    alertFindings         Int                   @default(0)
    alertType             Int                   @default(0)
    member_keys           MemberKey[]
    sessions              Session[]
    integration_usage_log IntegrationUsageLog[]
    triage_activity       Triage[]
    ghTokens              GitHubOAuth[]
    ownedCollections      Collection[]          @relation("CollectionOwner")
    leadCollections       Collection[]          @relation("CollectionLead")
    collectionMembers     CollectionMember[]
}

model GitHubOAuth {
    id             Int        @id @default(autoincrement())
    orgId          String
    org            Org        @relation(fields: [orgId], references: [uuid])
    memberUuid     String?
    member         Member?    @relation(fields: [memberUuid], references: [uuid])
    login          String?
    accessToken    String
    created        Int
    expires        Int?
    installationId Int?
    app            GitHubApp? @relation(fields: [installationId], references: [installationId])
}

model MemberKey {
    id         Int     @id @default(autoincrement())
    keyLabel   String?
    keyType    String
    memberUuid String
    member     Member  @relation(fields: [memberUuid], references: [uuid])
    secret     String
    suspend    Int     @default(0)

    @@unique([memberUuid, secret])
}

model GitHubPAT {
    uuid      String    @id @default(uuid())
    orgId     String
    org       Org       @relation(fields: [orgId], references: [uuid])
    login     String
    token     String
    expires   Int
    created   Int
    avatarUrl String?
    repos     GitRepo[]
}

model GitHubApp {
    installationId Int           @id
    orgId          String
    org            Org           @relation(fields: [orgId], references: [uuid])
    tokens         GitHubOAuth[]
    identifier     String
    identifierType String // org, user
    created        Int
    avatarUrl      String?
    repos          GitRepo[]
}

model Tags {
    uuid        String          @id @default(uuid())
    name        String
    url         String?
    orgId       String
    org         Org             @relation(fields: [orgId], references: [uuid])
    collections CollectionTag[]
}

model CollectionTag {
    collectionId String
    tagId        String
    collection   Collection @relation(fields: [collectionId], references: [uuid])
    tag          Tags       @relation(fields: [tagId], references: [uuid])

    @@id([collectionId, tagId])
}

model GitRepo {
    fullName         String
    orgId            String
    org              Org                @relation(fields: [orgId], references: [uuid])
    ghAppId          Int?
    ghApp            GitHubApp?         @relation(fields: [ghAppId], references: [installationId])
    ghPATId          String?
    ghPAT            GitHubPAT?         @relation(fields: [ghPATId], references: [uuid])
    ghid             Int?
    source           String
    createdAt        Int
    updatedAt        Int
    pushedAt         Int
    defaultBranch    String
    ownerId          Int
    licenseSpdxId    String?
    licenseName      String?
    fork             Int                @default(0)
    template         Int                @default(0)
    archived         Int                @default(0)
    visibility       String
    avatarUrl        String?
    sarif            SARIFInfo[]
    spdx             SPDXInfo[]
    cdx              CycloneDXInfo[]
    findings         Finding[]
    branches         GitBranch[]
    RequirementScope RequirementScope[]
    collectionRepos  CollectionRepo[]
    contributors     GitRepoContributor[]
    languages        GitRepoLanguage[]

    @@id([fullName, orgId])
}

model GitBranch {
    name      String
    repoName  String
    repo      GitRepo @relation(fields: [repoName, orgId], references: [fullName, orgId])
    commitSha String
    protected Int     @default(0)
    monitored Int     @default(0)
    orgId     String
    org       Org     @relation(fields: [orgId], references: [uuid])

    @@id([repoName, name])
}

model SARIFInfo {
    reportId     String         @id
    sarifId      String
    fullName     String?
    repo         GitRepo?       @relation(fields: [fullName, orgId], references: [fullName, orgId])
    orgId        String
    org          Org            @relation(fields: [orgId], references: [uuid])
    source       String
    artifactUuid String
    artifact     Artifact       @relation(fields: [artifactUuid], references: [uuid])
    commitSha    String?
    ref          String?
    createdAt    Int
    resultsCount Int
    rulesCount   Int
    toolName     String?
    toolVersion  String?
    analysisKey  String?
    warning      String?
    results      SarifResults[]
}

model SarifResults {
    guid                String    @id
    reportId            String
    sarif               SARIFInfo @relation(fields: [reportId], references: [reportId])
    messageText         String
    ruleId              String
    locations           String?
    automationDetailsId String?
    rulesetName         String?
    level               String?
    description         String?
    helpMarkdown        String?
    securitySeverity    String?
    precision           String?
    tags                String?
}

model CycloneDXInfo {
    cdxId        String       @id
    source       String
    orgId        String
    org          Org          @relation(fields: [orgId], references: [uuid])
    repoName     String?
    repo         GitRepo?     @relation(fields: [repoName, orgId], references: [fullName, orgId])
    artifactUuid String
    artifact     Artifact     @relation(fields: [artifactUuid], references: [uuid])
    cdxVersion   String
    serialNumber String?
    name         String?
    version      String?
    createdAt    Int
    toolName     String?
    findings     Finding[]
    dependencies Dependency[] @relation("depsCDX")
}

model SPDXInfo {
    spdxId            String       @id
    source            String
    orgId             String
    org               Org          @relation(fields: [orgId], references: [uuid])
    repoName          String?
    repo              GitRepo?     @relation(fields: [repoName, orgId], references: [fullName, orgId])
    artifactUuid      String
    artifact          Artifact     @relation(fields: [artifactUuid], references: [uuid])
    spdxVersion       String
    dataLicense       String?
    name              String?
    version           String?
    documentNamespace String?
    createdAt         Int
    toolName          String?
    documentDescribes String?
    comment           String?
    findings          Finding[]
    dependencies      Dependency[] @relation("depsSPDX")
}

model Dependency {
    key              String         @id
    name             String
    version          String
    license          String?
    packageEcosystem String?
    isDev            Int            @default(0)
    isDirect         Int            @default(0)
    isIndirect       Int            @default(0)
    isTransitive     Int            @default(0)
    isShared         Int            @default(0)
    isPeer           Int            @default(0)
    childOfKey       String?
    childOf          Dependency?    @relation("dependsOn", fields: [childOfKey], references: [key])
    dependencies     Dependency[]   @relation("dependsOn")
    spdxId           String?
    spdx             SPDXInfo?      @relation("depsSPDX", fields: [spdxId], references: [spdxId])
    cdxId            String?
    cdx              CycloneDXInfo? @relation("depsCDX", fields: [cdxId], references: [cdxId])

    @@unique([name, version, spdxId], name: "spdx_dep")
    @@unique([name, version, cdxId], name: "cdx_dep")
}

model IntegrationUsageLog {
    id         Int     @id @default(autoincrement())
    orgId      String
    org        Org     @relation(fields: [orgId], references: [uuid])
    source     String
    memberUuid String
    member     Member  @relation(fields: [memberUuid], references: [uuid])
    request    String
    response   String?
    statusCode Int
    createdAt  Int
}

model Finding {
    uuid                       String         @id @default(uuid())
    findingId                  String
    orgId                      String
    org                        Org            @relation(fields: [orgId], references: [uuid])
    repoName                   String?
    repo                       GitRepo?       @relation(fields: [repoName, orgId], references: [fullName, orgId])
    source                     String
    category                   String
    createdAt                  Int
    modifiedAt                 Int
    publishedAt                Int?
    detectionTitle             String
    detectionDescription       String?
    purl                       String?
    cpe                        String?
    databaseReviewed           Int?
    aliases                    String?
    cwes                       String?
    packageName                String
    packageVersion             String?
    packageLicense             String?
    vendor                     String?
    product                    String?
    packageEcosystem           String?
    customCvssVector           String?
    customCvssScore            String?
    advisoryUrl                String?
    exploitsJSON               String?
    knownExploitsJSON          String?
    cisaDateAdded              Int?
    knownRansomwareCampaignUse String?
    fixVersion                 String?
    fixAutomatable             Int?
    vulnerableVersionRange     String?
    affectedFunctions          String?
    malicious                  Int?
    abandoned                  Int?
    squattedPackage            String?
    referencesJSON             String?
    timelineJSON               String?
    confidenceScore            String?
    confidenceLevel            String?
    confidenceRationaleJSON    String?
    spdxId                     String?
    spdx                       SPDXInfo?      @relation(fields: [spdxId], references: [spdxId])
    cdxId                      String?
    cdx                        CycloneDXInfo? @relation(fields: [cdxId], references: [cdxId])
    triage                     Triage[]
}

model Triage {
    uuid                  String    @id @default(uuid())
    artifactUuid          String?
    artifact              Artifact? @relation(fields: [artifactUuid], references: [uuid])
    findingUuid           String
    finding               Finding   @relation(fields: [findingUuid], references: [uuid])
    createdAt             Int
    triagedAt             Int?
    lastObserved          Int
    seen                  Int
    seenAt                Int?
    cvssVector            String?
    cvssScore             String?
    cvssSource            String?
    epssPercentile        String?
    epssScore             String?
    ssvc                  String?
    remediation           String?
    analysisState         String
    analysisJustification String?
    analysisResponse      String?
    analysisDetail        String?
    triageAutomated       Int       @default(0)
    memberUuid            String?
    member                Member?   @relation(fields: [memberUuid], references: [uuid])

    @@unique([memberUuid, analysisState])
}

model CVEMetadata {
    cveId                String               @id
    dataVersion          String
    state                String
    datePublished        Int
    dateUpdated          Int?
    dateReserved         Int?
    vectorString         String?
    title                String
    sourceAdvisoryRef    String?
    affectedVendor       String?
    affectedProduct      String?
    affectedVersionsJSON String?
    cpesJSON             String?
    cnaOrgId             String
    cna                  CVENumberingAuthrity @relation(fields: [cnaOrgId], references: [orgId])
    fileLinkId           Int
    fileLink             Link                 @relation(fields: [fileLinkId], references: [id])
    adp                  CVEADP[]
}

model CVENumberingAuthrity {
    orgId     String        @id
    shortName String
    cves      CVEMetadata[]
}

model CVEADP {
    cve   CVEMetadata             @relation(fields: [cveId], references: [cveId])
    cveId String
    adp   AuthorizedDataPublisher @relation(fields: [adpId], references: [orgId])
    adpId String

    @@id([cveId, adpId])
}

model AuthorizedDataPublisher {
    orgId     String   @id
    shortName String
    title     String
    cves      CVEADP[]
}

model Link {
    id            Int            @id @default(autoincrement())
    url           String
    contentType   String // OCI PLAIN_JSON OCTET_STREAM PLAIN_XML
    artifact      Artifact?      @relation(fields: [artifactUuid], references: [uuid])
    artifactUuid  String?
    cves          CVEMetadata[]
    queueMessages QueueMessage[]
}

model Artifact {
    uuid                      String                   @id @default(uuid())
    type                      String // BOM ATTESTATION VDR VEX OTHER
    date                      Int
    bomFormat                 String
    downloadLinks             Link[]
    sarif                     SARIFInfo[]
    cdx                       CycloneDXInfo[]
    spdx                      SPDXInfo[]
    vex                       Triage[]
    testingProcedureEvidences TestingProcedureResult[] @relation("TestingProcedureEvidence")
    collectionArtifacts       CollectionArtifact[]
}

model CollectionRepo {
    id           Int        @id @default(autoincrement())
    collectionId String
    collection   Collection @relation(fields: [collectionId], references: [uuid])
    repoName     String
    repo         GitRepo    @relation(fields: [repoName, orgId], references: [fullName, orgId])
    orgId        String
    org          Org        @relation(fields: [orgId], references: [uuid])
}

model CollectionArtifact {
    id           Int        @id @default(autoincrement())
    collectionId String
    collection   Collection @relation(fields: [collectionId], references: [uuid])
    artifactUuid String
    artifact     Artifact   @relation(fields: [artifactUuid], references: [uuid])
}

model CollectionMember {
    id           Int        @id @default(autoincrement())
    collectionId String
    collection   Collection @relation(fields: [collectionId], references: [uuid])
    memberUuid   String
    member       Member     @relation(fields: [memberUuid], references: [uuid])
    title        String?
}

model CollectionTeam {
    productId String
    teamId    String
    product   Collection @relation("ProductTeamsProduct", fields: [productId], references: [uuid])
    team      Collection @relation("ProductTeamsTeam", fields: [teamId], references: [uuid])

    @@id([productId, teamId])
}

model CollectionProject {
    productId String
    projectId String
    product   Collection @relation("ProductProjectsProduct", fields: [productId], references: [uuid])
    project   Collection @relation("ProductProjectsProject", fields: [projectId], references: [uuid])

    @@id([productId, projectId])
}

model Collection {
    uuid           String               @id @default(uuid())
    name           String
    type           String // 'Project' | 'Product' | 'Team' | 'Campaign' | 'Group'
    orgId          String
    org            Org                  @relation(fields: [orgId], references: [uuid])
    parentUuid     String? // For sub-collections/groups
    parent         Collection?          @relation("CollectionParent", fields: [parentUuid], references: [uuid])
    subCollections Collection[]         @relation("CollectionParent")
    // Common fields
    ownerEmail     String? // For Product, Project, Team, Campaign (SME)
    owner          Member?              @relation("CollectionOwner", fields: [ownerEmail], references: [email])
    leadEmail      String? // For Project, Team (main contact)
    lead           Member?              @relation("CollectionLead", fields: [leadEmail], references: [email])
    triagePolicyId String?
    triagePolicy   TriagePolicy?        @relation("CollectionTriagePolicy", fields: [triagePolicyId], references: [uuid])
    releaseBranch  String?
    // Project/Team specific
    deadline       Int? // For Project (required), Campaign (required)
    // Campaign specific
    description    String?
    cweList        String? // CSV or JSON string
    findingAliases String? // CSV or JSON string
    keywords       String? // CSV or JSON string
    cvssThreshold  Float?
    // Relations
    gitRepos       CollectionRepo[]
    artifacts      CollectionArtifact[]
    members        CollectionMember[]
    // Product sub-collections (many-to-many via join tables)
    teams          CollectionTeam[]     @relation("ProductTeamsProduct")
    asTeam         CollectionTeam[]     @relation("ProductTeamsTeam")
    projects       CollectionProject[]  @relation("ProductProjectsProduct")
    asProject      CollectionProject[]  @relation("ProductProjectsProject")
    createdAt      Int
    tags           CollectionTag[]
    reports        Report[]
}

// --- Remove Product, ProductRepos, ProductTags, ProductTags, ProductOwner, ProductArtifacts, etc. if not needed ---
// Following are shared records
model ReportType {
    uuid              String             @id @default(uuid())
    type              String // e.g. "PCI DSS"
    version           String // e.g. "4.0.1"
    requirements      Requirement[]
    testingProcedures TestingProcedure[]
    reports           Report[]
}

model Requirement {
    uuid                  String              @id @default(uuid())
    reportTypeId          String
    reportType            ReportType          @relation(fields: [reportTypeId], references: [uuid])
    title                 String
    description           String
    currentlyBestPractice Int                 @default(0)
    serviceProvidersOnly  Int                 @default(0)
    testingProcedures     TestingProcedure[]
    results               RequirementResult[]
}

model TestingProcedure {
    uuid                    String                   @id @default(uuid())
    reportTypeId            String
    reportType              ReportType               @relation(fields: [reportTypeId], references: [uuid])
    requirementId           String
    requirement             Requirement              @relation(fields: [requirementId], references: [uuid])
    title                   String
    description             String
    // Many-to-many relation with ReportingInstructions
    instructions            ReportingInstructions[]  @relation("TestingProcedureInstructions")
    testingProcedureResults TestingProcedureResult[]
}

model ReportingInstructions {
    uuid              String             @id @default(uuid())
    text              String
    // Implicit many-to-many relation with TestingProcedure
    testingProcedures TestingProcedure[] @relation("TestingProcedureInstructions")
}

// Following are Reporting records
model RequirementResult {
    uuid                String                   @id @default(uuid())
    requirementId       String
    requirement         Requirement              @relation(fields: [requirementId], references: [uuid])
    reportId            String
    report              Report                   @relation(fields: [reportId], references: [uuid])
    orgId               String
    org                 Org                      @relation(fields: [orgId], references: [uuid])
    detail              String
    assessmentFinding   String                   @default("Not Tested")
    automatedAssessment Int                      @default(1)
    automatedEvidence   Int                      @default(0)
    method              String?
    step1               String                   @default("")
    step2               String                   @default("")
    step3               String                   @default("")
    step4               String                   @default("")
    // Relation to scope and testing procedures results
    scope               RequirementScope[]
    results             TestingProcedureResult[]
}

model RequirementScope {
    uuid                String            @id @default(uuid())
    orgId               String
    requirementResultId String
    requirementResult   RequirementResult @relation(fields: [requirementResultId], references: [uuid])
    repoName            String
    repo                GitRepo           @relation(fields: [repoName, orgId], references: [fullName, orgId])
    confirmed           Int               @default(0)
}

model TestingProcedureResult {
    uuid                String            @id @default(uuid())
    testingProcedureId  String
    testingProcedure    TestingProcedure  @relation(fields: [testingProcedureId], references: [uuid])
    requirementResultId String
    requirementResult   RequirementResult @relation(fields: [requirementResultId], references: [uuid])
    reportingDetails    String
    // Implicit many-to-many relation with Artifacts
    evidence            Artifact[]        @relation("TestingProcedureEvidence")
}

model Report {
    uuid               String              @id @default(uuid())
    reportTypeId       String
    reportType         ReportType          @relation(fields: [reportTypeId], references: [uuid])
    lastGenerated      Int
    initialDate        Int
    assessmentDueDate  Int
    status             String              @default("draft")
    orgId              String
    org                Org                 @relation(fields: [orgId], references: [uuid])
    requirementResults RequirementResult[]
    collectionId       String?
    collection         Collection?         @relation(fields: [collectionId], references: [uuid])
}

model QueueMessage {
    messageId String @unique
    status    String
    uniqueId  String?
    linkId    Int?
    link      Link?   @relation(fields: [linkId], references: [id])
    type      String
    orgId     String
    org       Org    @relation(fields: [orgId], references: [uuid])
    createdAt Int
}

// TEA (Transparency Exchange API) Models
model TeaProduct {
    uuid            String                @id
    type            String
    barcode         String?
    sku             String?
    vendor          String?
    namespace       String
    name            String
    version         String?
    qualifiers      String? // JSON array of qualifiers
    identifiers     String? // JSON array of identifiers
    subpath         String?
    primaryLanguage String?
    homepageUrl     String?
    downloadUrl     String?
    description     String?
    releaseDate     String?
    validUntilDate  String?
    orgId           String?
    org             Org?                  @relation(fields: [orgId], references: [uuid])
    createdAt       Int
    updatedAt       Int
    releases        TeaRelease[]
    components      TeaProductComponent[]
    collections     TeaCollection[]       @relation("TeaCollectionProducts")

    @@index([type, namespace, name])
    @@index([orgId])
}

model TeaComponent {
    uuid            String                @id
    type            String
    barcode         String?
    sku             String?
    vendor          String?
    namespace       String
    name            String
    version         String?
    qualifiers      String? // JSON array of qualifiers
    identifiers     String? // JSON array of identifiers
    subpath         String?
    primaryLanguage String?
    homepageUrl     String?
    downloadUrl     String?
    description     String?
    releaseDate     String?
    validUntilDate  String?
    orgId           String?
    org             Org?                  @relation(fields: [orgId], references: [uuid])
    createdAt       Int
    updatedAt       Int
    products        TeaProductComponent[]
    releases        TeaReleaseComponent[]

    @@index([type, namespace, name])
    @@index([orgId])
}

model TeaRelease {
    uuid           String                @id
    productUuid    String
    product        TeaProduct            @relation(fields: [productUuid], references: [uuid])
    tag            String
    version        String?
    name           String?
    description    String?
    releaseDate    String?
    validUntilDate String?
    prerelease     Boolean               @default(false)
    draft          Boolean               @default(false)
    orgId          String?
    org            Org?                  @relation(fields: [orgId], references: [uuid])
    createdAt      Int
    updatedAt      Int
    components     TeaReleaseComponent[]

    @@index([productUuid])
    @@index([orgId])
}

model TeaCollection {
    uuid        String       @id
    name        String
    description String?
    artifacts   String? // JSON array of artifacts
    lifecycle   String? // JSON object for lifecycle info
    orgId       String?
    org         Org?         @relation(fields: [orgId], references: [uuid])
    createdAt   Int
    updatedAt   Int
    products    TeaProduct[] @relation("TeaCollectionProducts")

    @@index([orgId])
}

model TeaProductComponent {
    id            Int          @id @default(autoincrement())
    productUuid   String
    product       TeaProduct   @relation(fields: [productUuid], references: [uuid])
    componentUuid String
    component     TeaComponent @relation(fields: [componentUuid], references: [uuid])
    relationship  String?
    createdAt     Int

    @@unique([productUuid, componentUuid])
    @@index([productUuid])
    @@index([componentUuid])
}

model TeaReleaseComponent {
    id            Int          @id @default(autoincrement())
    releaseUuid   String
    release       TeaRelease   @relation(fields: [releaseUuid], references: [uuid])
    componentUuid String
    component     TeaComponent @relation(fields: [componentUuid], references: [uuid])
    relationship  String?
    createdAt     Int

    @@unique([releaseUuid, componentUuid])
    @@index([releaseUuid])
    @@index([componentUuid])
}

model GitRepoContributor {
    repoName              String
    orgId                 String
    repo                  GitRepo @relation(fields: [repoName, orgId], references: [fullName, orgId])
    githubId              Int
    login                 String
    avatarUrl             String?
    type                  String
    siteAdmin             Int     @default(0)
    contributions         Int
    createdAt             Int
    updatedAt             Int

    @@id([repoName, orgId])
}

model Languages {
    uuid        String            @id @default(uuid())
    displayName String
    slug        String            @unique
    githubId    String?
    repos       GitRepoLanguage[]

    @@index([slug])
}

model GitRepoLanguage {
    repoName     String
    orgId        String
    repo         GitRepo   @relation(fields: [repoName, orgId], references: [fullName, orgId])
    languageUuid String
    language     Languages @relation(fields: [languageUuid], references: [uuid])

    @@id([repoName, orgId, languageUuid])
    @@index([repoName, orgId])
    @@index([languageUuid])
}
