CREATE TABLE "TriagePolicy" (
    "uuid" TEXT NOT NULL PRIMARY KEY,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "createdAt" INTEGER NOT NULL,
    "enabled" INTEGER NOT NULL DEFAULT 1,
    "isSystem" INTEGER NOT NULL DEFAULT 0,
    "cvssCriticalRemediationDays" INTEGER NOT NULL,
    "cvssHighRemediationDays" INTEGER NOT NULL,
    "cvssMediumRemediationDays" INTEGER NOT NULL,
    "cvssLowRemediationDays" INTEGER NOT NULL,
    "remediationCriticalThresholdAllowance" INTEGER NOT NULL,
    "remediationHighThresholdAllowance" INTEGER NOT NULL,
    "remediationMediumThresholdAllowance" INTEGER NOT NULL,
    "remediationLowThresholdAllowance" INTEGER NOT NULL,
    "triageThresholdDays" INTEGER NOT NULL,
    "exposureWindowDays" INTEGER NOT NULL,
    "severityHighThreshold" REAL NOT NULL,
    "severityMediumThreshold" REAL NOT NULL,
    "severityLowThreshold" REAL NOT NULL
);

CREATE TABLE "OrgTriagePolicy" (
    "orgId" TEXT NOT NULL,
    "triagePolicyId" TEXT NOT NULL,

    PRIMARY KEY ("orgId", "triagePolicyId")
);

ALTER TABLE "Org" ADD "enforceCompanyDomain" TEXT DEFAULT "";

INSERT INTO TriagePolicy (
    `uuid`,
    `name`,
    `description`,
    `createdAt`,
    `enabled`,
    `isSystem`,
    `cvssCriticalRemediationDays`,
    `cvssHighRemediationDays`,
    `cvssMediumRemediationDays`,
    `cvssLowRemediationDays`,
    `remediationCriticalThresholdAllowance`,
    `remediationHighThresholdAllowance`,
    `remediationMediumThresholdAllowance`,
    `remediationLowThresholdAllowance`,
    `triageThresholdDays`,
    `exposureWindowDays`,
    `threatWindowDays`,
    `severityHighThreshold`,
    `severityMediumThreshold`,
    `severityLowThreshold`
) VALUES (
    "b1e2c3d4-0001-0000-0000-000000000000",
    "Baseline CVSS",
    "Basic Triage Policy for Vulnerability Management",
    strftime("%s", "now") * 1000,
    1,
    1,
    30,
    90,
    180,
    365,
    30,
    90,
    180,
    365,
    30,
    2,
    14,
    8.9,
    6.9,
    4.0
), (
    "b1e2c3d4-0001-0000-0000-000000000001",
    "NIST SP 800-40",
    "NIST SP 800-40 does not specify exact remediation timeframes, but aligns with recommendations from CISA",
    strftime("%s", "now") * 1000,
    1,
    1,
    30,
    30,
    90,
    120,
    30,
    30,
    90,
    180,
    1,
    2,
    14,
    8.9,
    6.9,
    4.0
), (
    "b1e2c3d4-0001-0000-0000-000000000002",
    "FedRAMP",
    "FedRAMP Plan of Actions and Milestones (POA&M)",
    strftime("%s", "now") * 1000,
    1,
    1,
    30,
    30,
    90,
    180,
    30,
    30,
    90,
    180,
    14,
    30,
    14,
    8.9,
    6.9,
    4.0
), (
    "b1e2c3d4-0001-0000-0000-000000000003",
    "Essential 8",
    "Australian Information Security Manual (ISM) Essential Eight Maturity Model",
    strftime("%s", "now") * 1000,
    1,
    1,
    2,
    14,
    14,
    14,
    2,
    14,
    60,
    90,
    1,
    2,
    14,
    8.9,
    6.9,
    4.0
), (
    "b1e2c3d4-0001-0000-0000-000000000004",
    "CISA BOD 19-02",
    "CISA Binding Operational Directive 19-02 (BOD 19-02) Critical Vulnerability Mitigation Requirements for Federal Civilian Executive Branch Departments and Agencies Internet-Accessible Systems (May 21, 2015)",
    strftime("%s", "now") * 1000,
    1,
    1,
    15,
    15,
    30,
    30,
    15,
    15,
    30,
    30,
    1,
    15,
    15,
    8.9,
    6.9,
    4.0
);
